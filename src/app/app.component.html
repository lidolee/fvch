<div class="paper-sheet">
  <header class="mobile-header p-3 border-bottom d-lg-none">
    <div class="d-flex justify-content-between align-items-center">
      <h1 class="h5 mb-0 fw-bold">ChartaFlow</h1>
      <button class="btn btn-sm btn-outline-secondary" type="button" (click)="toggleSummaryOffcanvas()">
        <i class="bi bi-receipt"></i> Offerte
      </button>
    </div>
  </header>

  <div class="paper-sheet-inner-content">
    <div class="row g-0">
      <main class="col-12 col-lg-7 config-main-wrapper">
        <nav class="stepper-navigation d-flex justify-content-around" id="stepper">
          <div *ngFor="let step of stepsConfiguration"
               class="step-indicator"
               [class.active]="step.number === currentStep"
               [class.completed]="step.number < currentStep && step.validationState !== 'red'"
               [attr.data-step]="step.number"
               [attr.data-validation]="step.validationState"
               (click)="canNavigateToStep(step.number) && navigateToStep(step.number)">
            <div class="step-label-group">
              <i class="icon bi {{step.icon}}"></i>
              <span class="label">{{step.label}}</span>
            </div>
            <i class="validation-icon bi {{getValidationIconClass(step.validationState)}}"></i>
          </div>
        </nav>

        <div id="steps-container" [style.transform]="'translateX(' + currentStepTransform + '%)'">
          <ng-container [ngSwitch]="currentStep">
            <app-distribution-step *ngSwitchCase="1" class="step-content" [ngClass]="getAnimationClass(1)"
                                   [formGroup]="distributionForm"
                                   (formValid)="updateStepValidation(1, $event)"
                                   (next)="navigateToStep(2)"
                                   (updateSummary)="updateDistributionSummary($event)">
            </app-distribution-step>

            <app-design-print-step *ngSwitchCase="2" class="step-content" [ngClass]="getAnimationClass(2)"
                                   [formGroup]="designPrintForm"
                                   (formValid)="updateStepValidation(2, $event)"
                                   (next)="navigateToStep(3)" (previous)="navigateToStep(1)"
                                   (updateSummary)="updateDesignPrintSummary($event)">
            </app-design-print-step>

            <app-contact-step *ngSwitchCase="3" class="step-content" [ngClass]="getAnimationClass(3)"
                              [formGroup]="contactForm"
                              (formValid)="updateStepValidation(3, $event)"
                              (next)="navigateToStep(4)" (previous)="navigateToStep(2)">
            </app-contact-step>

            <app-overview-step *ngSwitchCase="4" class="step-content" [ngClass]="getAnimationClass(4)"
                               [formData]="fvFlowForm.value"
                               [summaryData]="currentSummaryData"
                               (submitOffer)="submitOffer()" (previous)="navigateToStep(3)">
            </app-overview-step>
          </ng-container>
        </div>
      </main>

      <aside class="d-none d-lg-block col-lg-5 summary-sidebar">
        <app-summary [summaryData]="currentSummaryData" [showTitle]="true"></app-summary>
      </aside>
    </div>
  </div>
</div>

<!-- Offcanvas für mobile Zusammenfassung -->
<!-- Entferne Bootstrap-spezifische Klassen wie 'offcanvas', 'offcanvas-end', 'tabindex', 'id' (es sei denn, du nutzt sie für dein eigenes CSS) -->
<!-- Füge [ngClass] hinzu, um das Öffnen/Schließen zu steuern -->
<div class="custom-offcanvas" [class.open]="isSummaryOffcanvasOpen">
  <div class="custom-offcanvas-header border-bottom">
    <h5 class="custom-offcanvas-title">Ihre Offerte</h5>
    <!-- data-bs-dismiss entfernt, da wir es selbst steuern -->
    <button type="button" class="btn-close" (click)="toggleSummaryOffcanvas()" aria-label="Close"></button>
  </div>
  <div class="custom-offcanvas-body summary-sidebar">
    <app-summary [summaryData]="currentSummaryData" [showTitle]="false"></app-summary>
  </div>
</div>

<!-- Optional: Backdrop für das Offcanvas -->
<div class="custom-offcanvas-backdrop" *ngIf="isSummaryOffcanvasOpen" (click)="toggleSummaryOffcanvas()"></div>
